<!DOCTYPE html>
<html>
<head>
  <title>Admin WiFi Dashboard</title>
  <style>
    body {
      font-family: Arial;
      background: #f4f6f8;
      margin: 0;
    }
    header {
      background: #2d89ef;
      color: white;
      padding: 15px;
    }
    nav button {
      margin-right: 10px;
      padding: 8px 15px;
      border: none;
      cursor: pointer;
    }
    .container {
      padding: 20px;
    }
    .box {
      background: white;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    button.action {
      background: #2d89ef;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h2>Admin Dashboard WiFi</h2>
  <nav>
    <button onclick="showPage('dashboard')">Dashboard</button>
    <button onclick="showPage('create')">Buat Tagihan</button>
  </nav>
</header>

<div class="container">

  <!-- DASHBOARD -->
  <div id="dashboard" class="box">
    <h3>Daftar Tagihan</h3>
    <div id="data">Loading...</div>
  </div>

  <!-- CREATE TAGIHAN -->
  <div id="create" class="box" style="display:none">
    <h3>Buat Tagihan Baru</h3>

    <input id="email" placeholder="Email pelanggan"><br><br>
    <input id="bulan" type="month"><br><br>
    <input id="paket" placeholder="Paket (contoh: 20 Mbps)"><br><br>
    <input id="jumlah" type="number" placeholder="Jumlah (contoh: 150000)"><br><br>

    <button class="action" onclick="buatTagihan()">Buat Tagihan</button>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyt8Rmo4Wt2uzfRVRLEAIeBOoKW2F3iQ8UWfaQLxLD0G3J9Zbl-Q3SG2SGYEkQ9OsDMPA/exec";

// ========== NAV ==========
function showPage(page){
  document.getElementById("dashboard").style.display = page === "dashboard" ? "block" : "none";
  document.getElementById("create").style.display = page === "create" ? "block" : "none";
  if(page === "dashboard") loadData();
}

// ========== LOAD TAGIHAN ==========
function loadData(){
  document.getElementById("data").innerHTML = "Loading...";
  var s = document.createElement("script");
  s.src = API_URL + "?action=getAllTagihan&callback=showData";
  document.body.appendChild(s);
}

function showData(data){
  var html = "<table>";
  html += "<tr><th>Email</th><th>Bulan</th><th>Paket</th><th>Jumlah</th><th>Status</th><th>Aksi</th></tr>";

  data.forEach(t => {
    html += `
      <tr>
        <td>${t.email}</td>
        <td>${new Date(t.bulan).toLocaleDateString("id-ID",{month:"long",year:"numeric"})}</td>
        <td>${t.paket}</td>
        <td>Rp ${t.jumlah.toLocaleString("id-ID")}</td>
        <td>${t.status}</td>
        <td>
          ${t.status !== "Lunas"
            ? `<button class="action" onclick="setLunas(${t.row})">Lunas</button>`
            : "âœ”"}
        </td>
      </tr>
    `;
  });

  html += "</table>";
  document.getElementById("data").innerHTML = html;
}

// ========== UPDATE STATUS ==========
function setLunas(row){
  if(!confirm("Tandai Lunas?")) return;

  var s = document.createElement("script");
  s.src = API_URL
    + "?action=updateStatus"
    + "&row=" + row
    + "&status=Lunas"
    + "&callback=afterUpdate";
  document.body.appendChild(s);
}

function afterUpdate(){
  alert("Status diperbarui");
  loadData();
}

// ========== CREATE TAGIHAN ==========
function buatTagihan(){
  var email = document.getElementById("email").value;
  var bulan = document.getElementById("bulan").value + "-01";
  var paket = document.getElementById("paket").value;
  var jumlah = document.getElementById("jumlah").value;

  if(!email || !bulan || !paket || !jumlah){
    alert("Lengkapi semua data");
    return;
  }

  var s = document.createElement("script");
  s.src = API_URL
    + "?action=createTagihan"
    + "&email=" + encodeURIComponent(email)
    + "&bulan=" + bulan
    + "&paket=" + encodeURIComponent(paket)
    + "&jumlah=" + jumlah
    + "&callback=afterCreate";
  document.body.appendChild(s);
}

function afterCreate(res){
  if(res.status === "ok"){
    alert("Tagihan berhasil dibuat");
    document.getElementById("email").value = "";
    document.getElementById("bulan").value = "";
    document.getElementById("paket").value = "";
    document.getElementById("jumlah").value = "";
    showPage("dashboard");
  } else {
    alert("Gagal");
  }
}

// load awal
loadData();
</script>

</body>
</html>
